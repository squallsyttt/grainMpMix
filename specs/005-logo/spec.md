# Feature Specification: 商家列表与商家详情

**Feature Branch**: `005-logo`
**Created**: 2025-10-14
**Status**: Draft
**Input**: User description: "我今天想要完善一下 商家列表,商家列表要设计的尽可能多的展现商家的信息,商家本身对于运营可能比较不在意,他的商家logo图像展示可能用的图不是很好,在设计上我们需要考虑到这一点,就是俗人过商家图片很随意,列表里面他也要好看。商家点进去之后会看到商家详情,并且包含商家自己在售的符合平台分类的大米商品。我举个例子,平台制定了分类,大米,碎米。首页也只展示大米碎米,并且价格按照区域统一定价。如果这个商家只上架了大米,点进这个商家详情,除了商家基本的信息展示之外,就展示此商家目前支持平台运营的大米商品就行了。就是再次强调一个概念,平台上的商品只属于平台。商家如果上架了对应的产品就显示对应的品类,客户看到了知道他可以提供对应品类的大米就行"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 浏览商家列表 (Priority: P1)

用户打开商家列表页面,可以看到所有入驻平台的商家信息。即使商家提供的logo图片质量不佳(分辨率低、比例不协调、颜色不统一等),列表界面也能通过统一的设计规范呈现出整洁美观的视觉效果。每个商家卡片展示商家的核心信息,用户可以快速浏览和比较不同商家。

**Why this priority**: 这是用户了解平台商家的第一入口,直接影响用户对平台的整体印象和信任度。统一美观的列表设计能够弥补商家自主上传图片质量参差不齐的问题,提升平台专业形象。

**Independent Test**: 可以通过加载商家列表页面并验证以下内容来独立测试:是否展示所有商家,商家卡片是否包含必要信息(名称、地区、支持的品类等),即使图片质量差异较大界面是否保持视觉一致性,可以独立完成浏览体验。

**Acceptance Scenarios**:

1. **Given** 平台有多个商家入驻且商家logo质量参差不齐, **When** 用户访问商家列表页面, **Then** 展示所有商家卡片,每个卡片包含商家logo(经过统一处理)、商家名称、经营地区、支持的产品分类(如"大米、碎米"),界面整体美观统一
2. **Given** 某个商家上传了不规范的logo图片(如极端宽高比、过小分辨率), **When** 该商家展示在列表中, **Then** 图片通过占位背景、裁剪适配、默认边框等设计手段呈现出规范的视觉效果
3. **Given** 用户在商家列表页面, **When** 商家数量较多需要滚动查看, **Then** 页面流畅加载,保持良好的浏览体验

---

### User Story 2 - 查看商家详情 (Priority: P1)

用户从商家列表中点击某个商家,进入该商家的详情页面。详情页面展示商家的完整信息(如商家介绍、联系方式、经营地址等),以及该商家当前在平台上支持供应的产品品类。

**Why this priority**: 用户需要深入了解商家才能做出采购决策。商家详情是建立信任和促成交易的关键环节,必须优先实现。

**Independent Test**: 可以通过点击商家列表中的任意商家卡片,验证是否正确跳转到商家详情页,并检查详情页是否展示商家基本信息,可独立完成测试。

**Acceptance Scenarios**:

1. **Given** 用户在商家列表页面, **When** 用户点击某个商家卡片, **Then** 跳转到该商家的详情页面,展示商家名称、logo、联系方式、地址、经营范围等基本信息
2. **Given** 商家详情页已打开, **When** 页面加载完成, **Then** 除了商家基本信息外,还展示该商家在平台上架的产品分类区域(如"该商家供应的产品"部分)
3. **Given** 商家只提供了部分基本信息(如缺少地址), **When** 展示商家详情, **Then** 系统友好地显示已有信息,缺失字段使用合理的占位提示或隐藏该字段

---

### User Story 3 - 查看商家供应的平台产品 (Priority: P1)

用户在商家详情页面可以看到该商家在平台上已上架的产品品类。平台统一管理产品分类(如大米、碎米),商家只需标记自己能够供应哪些品类。用户看到的是平台的标准产品信息(名称、价格按区域统一定价、产品图片等),但知道这些产品可以从当前商家处采购。

**Why this priority**: 这是核心业务逻辑,用户需要知道某个商家能提供哪些产品,才能完成下单。"产品属于平台,商家提供供应能力"的模式是平台的关键商业模式。

**Independent Test**: 可以通过访问已上架特定产品的商家详情页,验证是否正确展示该商家支持的平台产品列表(如只上架大米的商家只显示大米,上架了大米和碎米的商家显示两者),可独立完成测试。

**Acceptance Scenarios**:

1. **Given** 商家A只上架了"大米"这一品类, **When** 用户查看商家A的详情页, **Then** 在产品区域只展示"大米"这个品类的平台标准产品信息(产品图片、名称、当前区域价格等)
2. **Given** 商家B上架了"大米"和"碎米"两个品类, **When** 用户查看商家B的详情页, **Then** 在产品区域展示"大米"和"碎米"两个品类的平台标准产品信息
3. **Given** 商家C暂未上架任何产品, **When** 用户查看商家C的详情页, **Then** 在产品区域显示友好的提示信息,如"该商家暂未上架产品"
4. **Given** 用户所在区域为A区, **When** 查看商家详情页的产品价格, **Then** 展示A区的统一定价,而非其他区域价格

---

### User Story 4 - 商家信息的多维度展示 (Priority: P2)

商家列表页面通过多维度展示商家信息(如评分、服务年限、认证标识、主营品类等),帮助用户快速筛选和比较商家。这些信息在不依赖高质量logo的情况下,也能让用户对商家形成全面认知。

**Why this priority**: 丰富的商家信息能够提升用户的选择效率和信任感,但不是最小可用功能,可以在基础展示完成后增强。

**Independent Test**: 可以通过在商家列表页面查看商家卡片,验证是否展示多个维度的信息(如评分、认证标识、经营年限等),可独立测试。

**Acceptance Scenarios**:

1. **Given** 商家有平台认证标识(如"平台认证"、"优质供应商"), **When** 商家展示在列表中, **Then** 在商家卡片上显著位置显示认证标识
2. **Given** 商家有用户评分数据, **When** 展示商家列表, **Then** 在商家卡片上显示评分(如"4.5星")和评价数量
3. **Given** 商家有经营年限信息, **When** 展示商家列表, **Then** 在商家卡片上显示"经营X年"等信息
4. **Given** 商家主营多个品类, **When** 展示商家列表, **Then** 在商家卡片上以标签形式显示主营品类(如"大米 · 碎米")

---

### Edge Cases

- **当商家logo缺失时**: 系统使用默认占位图,可以是品牌色块+商家名称首字母,或平台统一的默认商家图标
- **当商家logo为极端比例(如超宽或超高)时**: 通过固定宽高比的容器和背景填充/裁剪策略,确保卡片布局不被破坏
- **当商家未上架任何平台产品时**: 商家详情页展示基本信息,但产品区域显示"该商家暂未上架产品"的提示,不影响其他信息展示
- **当用户所在区域暂无商家时**: 商家列表显示"您所在区域暂无商家入驻,敬请期待"等友好提示
- **当商家信息(如地址、电话)缺失或不完整时**: 系统智能隐藏缺失字段或显示"暂未提供"等友好提示,不显示空白字段
- **当用户快速滚动商家列表时**: 采用图片懒加载和骨架屏策略,确保流畅体验
- **当商家数量非常多(如数百个)时**: 支持分页加载或无限滚动,避免一次性加载过多数据造成性能问题

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须根据用户所在区域,展示该区域已入驻平台的商家列表,每个商家以卡片形式呈现
- **FR-002**: 商家列表中的每个商家卡片必须展示:商家logo(或默认占位图)、商家名称、经营地区、支持的产品分类
- **FR-003**: 用户只能看到自己所在区域的商家,不同区域的用户看到的商家列表不同
- **FR-004**: 系统必须对商家上传的logo图片进行统一处理,包括:固定宽高比容器展示、背景填充或裁剪、默认边框或阴影效果,确保即使图片质量参差不齐也能保持界面美观统一
- **FR-005**: 当商家未上传logo或logo缺失时,系统必须使用默认占位图(详细策略见Assumptions第1条)
- **FR-006**: 用户必须能够从商家列表点击某个商家卡片,跳转到该商家的详情页面
- **FR-007**: 商家详情页必须展示商家的基本信息,包括:商家名称、logo、联系方式、经营地址、经营范围等(具体字段根据商家提供的信息动态展示)
- **FR-008**: 商家详情页必须展示该商家在平台上已上架的产品品类,以平台标准产品信息呈现(产品名称、产品图片、产品价格等)
- **FR-009**: 系统必须根据用户所在区域展示对应区域的产品统一定价,不同区域用户看到的价格可能不同(商家详情页产品展示规则见FR-010和FR-011)
- **FR-010**: 当商家只上架了部分品类(如只上架了"大米"而未上架"碎米")时,商家详情页只展示该商家已上架的品类
- **FR-011**: 当商家暂未上架任何产品时,商家详情页的产品区域必须显示友好的提示信息(如"该商家暂未上架产品")
- **FR-012**: 商家列表必须支持流畅的滚动浏览体验,在商家数量较多时采用分页加载或无限滚动策略
- **FR-013**: 商家列表中的商家卡片可以展示额外的多维度信息(如评分0-5星、认证标识[verified/pending/none]、经营年限、主营品类标签等),以丰富用户对商家的认知。详细数据模型定义见 `data-model.md`
- **FR-014**: 系统必须智能处理商家信息缺失的情况,缺失字段应隐藏或显示友好提示,不展示空白字段
- **FR-015**: 当用户所在区域暂无商家入驻时,系统必须显示友好的提示信息

### Key Entities

- **商家(Merchant)**: 代表入驻平台的商家实体,包含属性:商家ID、商家名称、商家logo、所属区域ID、联系方式、经营地址、经营范围、认证状态、评分、经营年限等。每个商家归属于特定区域
- **平台产品分类(Product Category)**: 平台统一管理的产品分类,如"大米"、"碎米",包含属性:分类ID、分类名称、分类图片、分类描述等
- **商家-产品关联(Merchant-Product Mapping)**: 表示商家上架了哪些平台产品分类,包含属性:商家ID、产品分类ID、上架状态、上架时间等
- **区域定价(Regional Pricing)**: 平台产品按区域的统一定价,包含属性:产品分类ID、区域ID、价格、生效时间等
- **用户区域(User Region)**: 用户所在的地理区域,用于展示对应的区域定价

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在3秒内加载并浏览商家列表页面,即使商家数量超过50个
- **SC-002**: 即使商家上传的logo图片质量参差不齐(分辨率、比例、颜色各异),商家列表页面保持视觉一致性:所有商家logo使用1:1固定宽高比容器,间距统一使用8px倍数,圆角统一使用8px,边框和阴影效果统一(通过设计评审验证)
- **SC-003**: 用户可以在2次点击内从商家列表进入商家详情页,并查看该商家支持的平台产品
- **SC-004**: 商家详情页加载时间不超过2秒,包括商家信息和产品列表
- **SC-005**: 当商家未上架任何产品时,用户能够在商家详情页看到明确的提示信息,不会产生困惑
- **SC-006**: 系统能够正确根据用户所在区域展示对应的产品价格,价格显示准确率达到100%
- **SC-007**: 用户在商家列表和商家详情页的任务完成率(浏览商家、了解商家信息、查看商家产品)达到95%以上

### Assumptions

1. **默认占位图策略**: 当商家logo缺失或加载失败时,系统使用CSS方案生成默认占位图(不使用Canvas)。占位图由品牌色块+商家名称首字母组成,品牌色数组定义为:['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'],根据商家名称首字符编码取模选择颜色。具体实现见 `research.md` 第1.1节和 `src/utils/image.ts`
2. **图片处理标准**: 商家logo在列表和详情页中统一使用固定宽高比容器(如1:1或4:3),超出部分裁剪或使用背景填充
3. **区域识别**: 系统通过用户登录信息、IP地址或用户手动选择的方式识别用户所在区域
4. **商家区域归属**: 每个商家归属于特定区域,用户只能看到自己所在区域的商家。商家不能跨区域展示
5. **产品归属**: 平台产品(如"大米"、"碎米")的名称、图片、描述等信息由平台统一管理,商家只标记自己能够供应哪些品类,不能修改产品信息
6. **商家基本信息必填字段**: 假设商家名称和所属区域为必填字段,其他字段(如地址、电话)为可选,缺失时系统智能处理
7. **性能优化**: 商家列表采用图片懒加载和分页/无限滚动策略,确保大量商家时的流畅体验
8. **移动端优先**: 界面设计优先考虑移动端(小程序)的展示效果,确保在小屏幕上也能清晰展示商家信息
