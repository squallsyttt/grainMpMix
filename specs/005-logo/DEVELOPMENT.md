# 商家功能开发说明

## 开发模式（Mock数据）

当前商家功能已配置为**开发模式**，使用mock数据，无需登录和后端服务即可运行。

### 配置位置

文件：`src/services/merchant.ts`

```typescript
/**
 * 是否使用Mock数据（开发模式）
 */
const USE_MOCK = true
```

### Mock数据说明

Mock数据文件：`src/data/mock/merchant.ts`

包含：
- **6个商家**（黑龙江省不同城市）
- **3个商家的完整详情**
- **3个商家的产品列表**

#### 商家列表数据

| ID | 商家名称 | 城市 | Logo | 评分 | 认证 | 状态 |
|----|---------|------|------|------|------|------|
| 1 | 五常大米直营店 | 哈尔滨 | ✅ | 4.8 | 已认证 | 营业中 |
| 2 | 黑土地粮油 | 哈尔滨 | ❌ | 4.5 | 已认证 | 营业中 |
| 3 | 绿色农场粮仓 | 齐齐哈尔 | ✅ | 4.9 | 已认证 | 营业中 |
| 4 | 响水大米专卖 | 牡丹江 | ✅ | 4.7 | 审核中 | 营业中 |
| 5 | 北大荒米业 | 哈尔滨 | ❌ | 4.6 | 已认证 | 营业中 |
| 6 | 暂停营业的粮店 | 哈尔滨 | ✅ | 4.2 | 未认证 | 暂停营业 |

### 测试功能点

#### 1. 商家列表页

- **区域筛选**：选择"黑龙江省 > 哈尔滨市"，可以看到4个商家
- **无Logo处理**：商家ID 2、5使用首字母+颜色作为占位图
- **评分展示**：所有商家显示星级评分
- **认证标识**：已认证商家显示"已认证"徽章
- **产品标签**：显示商家主营产品品类
- **暂停营业**：商家ID 6为暂停营业状态（is_active=0）

#### 2. 商家详情页

可以查看的商家详情：
- **商家ID 1**：五常大米直营店（完整信息）
- **商家ID 2**：黑土地粮油（完整信息）
- **商家ID 3**：绿色农场粮仓（完整信息）

详情页包含：
- 商家Logo（或占位图）
- 基本信息（地址、电话、营业时间）
- 商家简介
- 供应产品列表

#### 3. 产品列表

- **商家ID 1**：3种产品（五常稻花香、五常长粒香、有机糙米）
- **商家ID 2**：3种产品（含1种"暂无货"产品）
- **商家ID 3**：3种产品（有机系列）

### 网络延迟模拟

Mock数据包含模拟的网络延迟：
- 商家列表：500ms
- 商家详情：300ms
- 产品列表：400ms

这样可以测试加载状态（Skeleton）是否正常显示。

## 切换到生产模式

当后端API准备就绪时，修改 `src/services/merchant.ts`：

```typescript
/**
 * 是否使用Mock数据（开发模式）
 */
const USE_MOCK = false  // 改为 false
```

然后确保：
1. 后端API已部署在 `http://localhost:8080`（或修改 `src/services/request.ts` 中的 `BASE_URL`）
2. 已获取有效的用户token
3. API接口符合 `specs/005-logo/contracts/merchant.yaml` 中的定义

## 开发建议

### 添加更多Mock数据

编辑 `src/data/mock/merchant.ts`，参考现有格式添加：

```typescript
export const mockMerchantList: MerchantListItem[] = [
  // ... 添加更多商家
  {
    id: 7,
    name: '新商家名称',
    // ... 其他字段
  }
]
```

### 测试不同场景

1. **空状态**：修改mock数据返回空数组
2. **错误状态**：在mock函数中使用 `reject()` 模拟错误
3. **无网络**：增加延迟时间到5000ms以上

### 调试技巧

打开浏览器控制台，可以看到：
```
[MerchantService] 使用Mock数据
```

这表示当前处于开发模式。

## 常见问题

### Q: 为什么选择区域后还是看不到商家？

**A**: 检查选择的省份和城市是否匹配mock数据中的地区：
- 黑龙江省 > 哈尔滨市：4个商家
- 黑龙江省 > 齐齐哈尔市：1个商家
- 黑龙江省 > 牡丹江市：1个商家

### Q: 如何模拟分页？

**A**: Mock数据已实现分页逻辑，可以修改请求参数：
```typescript
getMerchantList({
  province: '黑龙江省',
  city: '哈尔滨市',
  page: 2,  // 第2页
  limit: 2  // 每页2条
})
```

### Q: Logo图片显示不出来怎么办？

**A**: Mock数据使用的是 `https://picsum.photos` 提供的随机图片服务。如果网络不好，可以：
1. 替换为本地图片路径
2. 使用其他图片CDN
3. 直接留空测试占位图效果

## 技术细节

### Mock实现原理

```typescript
if (USE_MOCK) {
  return new Promise((resolve) => {
    setTimeout(() => {
      // 返回mock数据
      resolve(mockData)
    }, 500) // 模拟网络延迟
  })
}
```

### 与真实API的区别

- Mock模式：直接返回本地数据，不发起HTTP请求
- API模式：调用 `get()` 函数，需要token认证

两种模式返回的数据格式完全一致，确保无缝切换。
