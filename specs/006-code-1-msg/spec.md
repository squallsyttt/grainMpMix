# Feature Specification: 首页商品分类多级展示优化

**Feature Branch**: `006-code-1-msg`
**Created**: 2025-10-17
**Status**: Draft
**Input**: 用户描述: "现在首页这个分类展示我觉得后续兼容性不够 这是我商品分类接口的返回数据 {...} 是有父子分类的 后续可能会有三层四层 那我前端展示的时候现在的这种 只有一层就很奇怪,查看更多的时候怎么展示也不知道到底怎么办。这部分要详细规划一下"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 首页浏览一级分类 (Priority: P1)

用户打开首页时,能够快速浏览所有一级商品分类,每个分类显示名称、图标和商品数量。分类以网格形式展示,易于点击查看详情。

**Why this priority**: 这是用户进入首页后最基础的浏览需求,也是导航到商品的核心入口。必须首先保证一级分类的正常展示和交互。

**Independent Test**: 用户访问首页,可以看到完整的一级分类网格,点击任意分类能够跳转到对应的分类详情页,展示该分类下的所有商品。

**Acceptance Scenarios**:

1. **Given** 用户首次打开小程序首页, **When** 页面加载完成, **Then** 显示"产品分类"区块,展示所有一级分类(精米、碎米、香米、新米等)
2. **Given** 首页已加载完成, **When** 用户点击任意一级分类(如"香米"), **Then** 跳转到该分类的详情页面,显示该分类下的所有商品
3. **Given** 首页已加载完成, **When** 某个一级分类有子分类(如"香米"有"东北五常精品"子分类), **Then** 该分类卡片上显示子分类数量标识(如"4个子分类")

---

### User Story 2 - 查看二级子分类列表 (Priority: P2)

用户点击有子分类的一级分类后,能够看到该分类的所有二级子分类列表,每个子分类同样显示名称、图标和商品数量。用户可以选择查看整个一级分类的商品,或进一步选择某个二级子分类的商品。

**Why this priority**: 二级分类是商品细分的重要维度,帮助用户更精准地找到目标商品。这是在一级分类基础上的自然延伸。

**Independent Test**: 用户从首页点击"香米"分类,进入分类详情页,可以看到"东北五常精品"等子分类列表,点击子分类能够筛选显示该子分类的商品。

**Acceptance Scenarios**:

1. **Given** 用户在首页点击了有子分类的一级分类(如"香米"), **When** 进入分类详情页, **Then** 页面顶部显示子分类导航栏,展示所有二级子分类(如"东北五常精品")
2. **Given** 用户在分类详情页, **When** 点击某个二级子分类, **Then** 商品列表只显示该二级子分类下的商品
3. **Given** 用户在分类详情页查看二级子分类商品, **When** 点击"全部"或一级分类名称, **Then** 商品列表显示该一级分类下的所有商品(包含所有子分类的商品)

---

### User Story 3 - 展开多级分类树 (Priority: P3)

对于包含三级、四级子分类的复杂分类结构,用户可以通过展开/收起操作逐层查看分类树。每次展开显示下一级子分类,保持界面整洁不拥挤。

**Why this priority**: 这是为了应对未来可能出现的更复杂分类层级,当前数据主要是1-2级,三级以上的场景较少,优先级相对较低。

**Independent Test**: 当后端添加三级分类数据(如"香米 > 东北五常精品 > 5kg装")后,用户在分类页面可以通过点击箭头图标逐层展开查看,最终定位到三级分类的商品。

**Acceptance Scenarios**:

1. **Given** 某一级分类有三级子分类, **When** 用户点击该二级分类的展开图标, **Then** 显示其下所有三级子分类
2. **Given** 用户已展开某个二级分类, **When** 点击收起图标, **Then** 隐藏该二级分类下的所有三级子分类
3. **Given** 用户在多级分类树中, **When** 点击任意层级的分类, **Then** 商品列表更新为该分类及其所有子孙分类的商品

---

### User Story 4 - 首页分类"查看更多"功能 (Priority: P2)

当一级分类数量超过首页默认展示数量(如6个)时,用户可以点击"查看更多"按钮查看完整的分类列表。点击后跳转到专门的分类导航页面,展示所有一级分类及其子分类的树形结构。

**Why this priority**: 这是为了优化首页布局,避免分类数量过多时首页过长。同时为用户提供全局分类导航的入口。

**Independent Test**: 当系统有超过6个一级分类时,首页只显示前6个,并显示"查看更多"按钮。点击后进入分类导航页,用户可以浏览所有分类并选择进入。

**Acceptance Scenarios**:

1. **Given** 系统有8个一级分类, **When** 用户访问首页, **Then** 首页分类区块只显示前6个分类,并在底部显示"查看更多"按钮
2. **Given** 首页显示"查看更多"按钮, **When** 用户点击该按钮, **Then** 跳转到分类导航页,显示所有一级分类的网格列表
3. **Given** 用户在分类导航页, **When** 点击某个一级分类, **Then** 展开显示该分类的所有子分类(如果有)
4. **Given** 用户在分类导航页, **When** 点击某个具体分类(任意层级), **Then** 跳转到该分类的商品列表页

---

### Edge Cases

- **分类数据为空时**: 首页分类区块显示空状态提示"暂无商品分类",不显示网格和"查看更多"按钮
- **网络加载失败时**: 显示加载失败提示,提供"重新加载"按钮
- **某分类商品数为0时**: 仍然显示该分类,但商品数显示为"0",点击进入后显示空商品列表提示
- **子分类递归嵌套异常时**: 最多展示到第4层,如果数据深度超过4层,第4层不再显示展开图标
- **图片加载失败时**: 分类图标显示默认占位图,不影响文字信息展示
- **快速切换分类时**: 防止重复请求,使用请求去重和loading状态管理

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持从后端API获取树形结构的分类数据,数据格式包含 `id`、`pid`、`name`、`image`、`weigh`、`childlist` 等字段
- **FR-002**: 系统必须支持最多4层的分类层级展示(一级分类 > 二级 > 三级 > 四级)
- **FR-003**: 首页分类区块必须默认展示所有一级分类,当一级分类数量超过6个时,只显示前6个并提供"查看更多"按钮
- **FR-004**: 用户必须能够点击任意层级的分类,跳转到对应的商品列表页,显示该分类及其所有子孙分类的商品
- **FR-005**: 分类详情页必须支持二级子分类的水平滚动导航,用户可切换查看不同子分类的商品
- **FR-006**: 分类导航页必须支持树形结构展示,用户可以展开/收起任意包含子分类的节点
- **FR-007**: 每个分类卡片必须显示分类名称、分类图标、商品数量(如果该分类有子分类,显示子分类数量)
- **FR-008**: 系统必须根据 `weigh` 字段对同级分类进行排序,权重值大的排在前面
- **FR-009**: 系统必须处理分类图片的相对路径,拼接为完整的图片URL(如 `/uploads/xxx.jpg` 需要补全域名)

### Key Entities

- **Category(分类实体)**: 表示商品分类,包含唯一ID、父级ID、分类名称、分类图标、排序权重、子分类列表等属性。支持树形嵌套结构,通过 `pid` 字段关联父级,通过 `childlist` 字段包含子级
- **CategoryTree(分类树节点)**: 用于UI展示的分类树结构,包含分类基础信息、展开/收起状态、层级深度、是否为叶子节点等属性
- **CategoryNavigation(分类导航状态)**: 记录用户在分类导航中的浏览路径,包含当前选中的分类、面包屑路径、已展开的分类节点列表

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户从首页点击一级分类到看到该分类的商品列表,整个流程在3秒内完成(正常网络环境)
- **SC-002**: 支持至少100个一级分类和每个一级分类下50个子分类的数据量,页面加载和交互不出现明显卡顿(渲染时间<500ms)
- **SC-003**: 用户在分类导航页展开/收起分类树节点,响应时间在100ms以内,提供流畅的动画效果
- **SC-004**: 90%的用户能够在首次使用时理解分类层级关系,成功找到目标分类的商品(通过用户测试验证)
- **SC-005**: 分类图片加载失败率低于5%,加载失败时有明确的占位图显示,不影响用户识别分类名称

## Assumptions *(optional)*

- 假设后端API返回的分类数据结构稳定,始终包含 `id`、`pid`、`name`、`childlist` 等核心字段
- 假设分类层级不会超过4层,如果超过4层,前端只展示前4层
- 假设分类图片存储在后端服务器,路径以 `/uploads/` 开头,需要拼接 API base URL
- 假设商品数量统计由后端计算并返回,前端不需要遍历子分类累加
- 假设用户主要使用移动端小程序访问,界面优先适配移动端交互习惯(如水平滚动、手势操作)

## Out of Scope *(optional)*

- 不包含分类数据的本地缓存功能(MVP阶段暂不实现,后续考虑优化)
- 不包含分类的创建、编辑、删除等后台管理功能(这是管理端的功能)
- 不包含分类排序的拖拽调整功能(排序由后端 `weigh` 字段控制)
- 不包含分类的搜索和筛选功能(如搜索分类名称)
- 不包含分类的收藏、订阅等个性化功能
- 不包含基于分类的推荐算法(如"你可能感兴趣的分类")
- 不包含分类间的关联推荐(如"浏览香米的用户也看了碎米")
