# Feature Specification: 核销券个人中心主页设计

**Feature Branch**: `003-spec-pages-mine`
**Created**: 2025-10-13
**Status**: Draft
**Input**: 用户描述: "基于前两个spec分支,去设计一下我的页面。就是pages/mine/index,要符合这个项目的特点,核销相关的概念不同于一般电商。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 核销券快速入口与状态概览 (Priority: P1)

用户进入个人中心后,需要立即看到核销券的快速入口和状态统计(待核销、已核销、已过期的数量),能够一目了然自己的核销券情况,并快速进入各个状态的券列表。

**Why this priority**: 这是个人中心的核心价值,用户购买后最关心的就是核销券的状态。没有这个入口,用户无法管理自己的权益,这是最小可行产品(MVP)的核心功能。

**Independent Test**: 可以通过创建不同状态的测试券(3张待核销、2张已核销、1张已过期),访问个人中心,验证是否正确显示统计数据和快速入口,点击入口是否正确跳转到对应状态的券列表来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户已登录且拥有6张核销券(3张待核销、2张已核销、1张已过期), **When** 用户进入个人中心首页, **Then** 顶部显示核销券模块,包含3个状态卡片,分别显示"待核销(3)"、"已核销(2)"、"已过期(1)"
2. **Given** 用户在个人中心首页, **When** 用户点击"待核销"卡片, **Then** 跳转到核销券列表页,默认筛选显示待核销状态的券
3. **Given** 用户没有任何核销券, **When** 用户进入个人中心, **Then** 核销券模块显示"暂无核销券",三个状态均显示(0)
4. **Given** 用户有即将过期的券(7天内), **When** 用户进入个人中心, **Then** 待核销卡片上显示红点提醒标识,提示"有券即将过期"

---

### User Story 2 - 最近核销券展示与快速操作 (Priority: P1)

用户需要在个人中心直接看到最近的3张待核销券的基本信息(商品图片、名称、过期时间),并能快速点击进入详情查看二维码,无需先跳转到列表页再选择,缩短操作路径。

**Why this priority**: 减少用户的操作步骤,提升核销效率。大多数用户只会关注最近购买的几张券,直接展示可以节省至少2次点击。这个功能可以独立实现和测试,为用户提供直接价值。

**Independent Test**: 可以通过创建5张待核销券,验证个人中心是否只显示最近的3张,点击券卡片是否直接进入该券的详情页并显示二维码来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户有5张待核销券, **When** 用户进入个人中心首页, **Then** 在核销券状态卡片下方显示最近购买的3张待核销券,每张券显示商品图片、名称、购买时间、剩余有效天数
2. **Given** 用户在个人中心看到待核销券卡片, **When** 用户点击任意券卡片, **Then** 直接跳转到该券的详情页,显示二维码和可核销门店列表
3. **Given** 用户有超过3张待核销券, **When** 用户在个人中心查看, **Then** 在3张券卡片下方显示"查看全部"按钮,点击后跳转到完整的核销券列表页
4. **Given** 用户只有1张待核销券, **When** 用户进入个人中心, **Then** 只显示这1张券卡片,不显示空白占位
5. **Given** 用户没有待核销券但有已核销券, **When** 用户进入个人中心, **Then** 显示"暂无待核销券"占位提示和"查看已核销券"按钮

---

### User Story 3 - 订单入口与核销记录 (Priority: P2)

用户需要查看自己的完整订单记录,包括订单列表的快速入口,并能看到最近的订单状态(已支付、已完成、已取消),以便追溯购买历史和核对信息。

**Why this priority**: 订单记录是用户权益的重要凭证,虽然核销券是主要交互对象,但订单入口对于查账、处理纠纷、查看历史等场景很重要。这是一个独立的功能模块,不影响核销券的核心流程。

**Independent Test**: 可以通过创建不同状态的测试订单,验证个人中心是否正确显示订单入口和订单数量统计,点击入口是否正确跳转到订单列表页来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户已登录且有10个订单(8个已完成、2个待支付), **When** 用户进入个人中心, **Then** 在核销券模块下方显示"我的订单"入口,显示订单总数(10)
2. **Given** 用户在个人中心看到订单入口, **When** 用户点击"我的订单", **Then** 跳转到订单列表页,显示所有订单按时间倒序排列
3. **Given** 用户在个人中心, **When** 用户有待支付订单, **Then** 订单入口显示待支付数量徽标(2),吸引用户处理
4. **Given** 用户在个人中心看到订单模块, **When** 页面加载完成, **Then** 显示最近3个订单的简略信息(订单号、商品图片、订单状态),点击可直接进入订单详情

---

### User Story 4 - 用户信息展示与基础操作 (Priority: P2)

用户需要在个人中心顶部看到自己的基本信息(头像、昵称、会员等级),并能够点击头像或昵称进入个人资料编辑页面,修改头像、昵称等信息。

**Why this priority**: 这是用户身份的视觉确认,提升用户对账号的归属感和安全感。同时也是进入个人资料管理的入口,是个人中心的标准组成部分。可以独立开发,不依赖核销券功能。

**Independent Test**: 可以通过登录测试账号,验证个人中心顶部是否正确显示用户头像、昵称和会员信息,点击头像是否能进入资料编辑页来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户已登录, **When** 用户进入个人中心, **Then** 页面顶部显示用户头像、昵称、会员等级标识
2. **Given** 用户在个人中心顶部看到个人信息, **When** 用户点击头像或昵称, **Then** 跳转到个人资料编辑页面
3. **Given** 用户未设置头像, **When** 用户进入个人中心, **Then** 显示默认头像占位图
4. **Given** 用户在个人中心, **When** 用户是普通会员, **Then** 显示"普通会员"标识,如果是VIP会员则显示对应的VIP等级标识
5. **Given** 用户未登录, **When** 用户进入个人中心, **Then** 显示"点击登录"占位,点击后跳转到登录页面

---

### User Story 5 - 常用功能入口与设置 (Priority: P3)

用户需要在个人中心访问常用功能(地址管理、客服联系、意见反馈、设置)和查看系统信息(关于我们、隐私政策),这些功能以列表形式展示,方便用户快速找到。

**Why this priority**: 这些是辅助功能和系统入口,不影响核心的核销券业务流程,但对于完整的用户体验和平台规范(隐私政策、用户协议)是必要的。优先级相对较低,可以在核心功能完成后添加。

**Independent Test**: 可以通过访问个人中心,验证是否显示完整的功能列表,点击每个入口是否正确跳转到对应的功能页面或打开对应的操作来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在个人中心, **When** 用户滚动到订单模块下方, **Then** 显示功能列表区域,包含"收货地址"、"联系客服"、"意见反馈"、"设置"等入口
2. **Given** 用户在功能列表区域, **When** 用户点击"收货地址", **Then** 跳转到地址管理页面(为未来的跑腿配送功能预留)
3. **Given** 用户在功能列表区域, **When** 用户点击"联系客服", **Then** 打开客服对话窗口或拨打客服电话
4. **Given** 用户在功能列表区域, **When** 用户点击"设置", **Then** 跳转到设置页面,包含"关于我们"、"隐私政策"、"清除缓存"、"退出登录"等选项
5. **Given** 用户在设置页面, **When** 用户点击"退出登录", **Then** 显示确认弹窗,确认后清除登录状态并返回个人中心(显示未登录状态)

---

### User Story 6 - 跑腿配送入口预留 (Priority: P3)

在个人中心为未来的跑腿配送功能预留UI入口,当前阶段显示"即将上线"状态,方便后续功能扩展,避免大规模改版。

**Why this priority**: 这是未来扩展功能的占位,当前不实现完整功能。核心业务聚焦于核销券模式,跑腿配送作为补充功能预留入口即可。

**Independent Test**: 可以通过访问个人中心,验证是否显示跑腿配送的占位入口,点击后是否显示"即将上线"提示来独立测试。

**Acceptance Scenarios**:

1. **Given** 用户在个人中心, **When** 用户查看订单模块, **Then** 在"全部订单"旁边显示"跑腿配送"入口,但标注"即将上线"标识(灰色或特殊样式)
2. **Given** 用户在个人中心, **When** 用户点击"跑腿配送"入口, **Then** 显示提示弹窗"跑腿配送功能即将上线,敬请期待"
3. **Given** 系统管理员配置跑腿配送功能上线, **When** 用户进入个人中心, **Then** "跑腿配送"入口变为正常可用状态,点击后跳转到跑腿配送订单列表

---

### Edge Cases

- **网络异常导致数据加载失败**: 当个人中心的核销券、订单等数据加载失败时(网络超时、服务故障),各模块显示"加载失败,点击重试"提示和重试按钮
- **用户同时拥有大量核销券**: 当用户有超过100张核销券时,个人中心只显示最近的3张待核销券,避免首页加载过慢,通过"查看全部"进入列表页进行分页加载
- **头像图片加载失败**: 当用户头像图片加载失败时,显示默认头像占位图,不影响其他内容展示
- **会员等级未初始化**: 当新用户首次进入个人中心,会员等级数据未初始化时,默认显示"普通会员"
- **快速切换页面**: 当用户快速进入和退出个人中心时,避免数据请求冲突和状态错乱,使用请求去重或取消机制
- **核销券状态实时更新**: 当用户在其他设备或商家端核销了某张券后,个人中心的状态统计和券列表需要实时或准时同步更新(刷新页面后必须更新)
- **未登录用户访问**: 当未登录用户访问个人中心时,显示登录引导界面,包含"立即登录"按钮和部分功能的占位预览
- **地区切换影响**: 当用户切换当前选择的地区时(RegionBar),核销券的可核销门店会改变,但券列表和统计不受影响(券绑定购买地区),需要在券详情页明确提示"仅限XX地区核销"
- **订单支付超时**: 当用户有待支付订单超过30分钟未支付时,订单自动取消,个人中心的待支付徽标数量需要同步更新
- **客服入口不可用**: 当客服系统维护或不可用时,点击"联系客服"显示"客服暂时不可用,请稍后再试"并提供客服电话作为备选方案

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 个人中心页面必须在顶部显示用户基本信息区域,包含头像、昵称、会员等级
- **FR-002**: 用户信息区域必须支持点击头像或昵称跳转到个人资料编辑页面
- **FR-003**: 未登录用户访问个人中心时,必须显示登录引导界面和"立即登录"按钮
- **FR-004**: 个人中心必须显示核销券状态统计模块,包含三个状态卡片:待核销、已核销、已过期,分别显示对应数量
- **FR-005**: 用户必须能够点击核销券状态卡片,跳转到核销券列表页并自动筛选对应状态的券
- **FR-006**: 当用户有即将过期的券(7天内)时,待核销状态卡片必须显示红点提醒标识
- **FR-007**: 个人中心必须在核销券统计模块下方显示最近的3张待核销券(如果存在)
- **FR-008**: 每张待核销券卡片必须显示商品图片、名称、购买时间、剩余有效天数
- **FR-009**: 用户必须能够点击待核销券卡片,直接跳转到该券的详情页显示二维码
- **FR-010**: 当用户有超过3张待核销券时,必须在券卡片下方显示"查看全部"按钮
- **FR-011**: 当用户没有待核销券时,必须显示"暂无待核销券"占位提示和"查看已核销券"按钮
- **FR-012**: 个人中心必须显示"我的订单"入口模块,显示订单总数统计
- **FR-013**: 当用户有待支付订单时,订单入口必须显示待支付数量徽标
- **FR-014**: 个人中心必须在订单入口下方显示最近的3个订单的简略信息(订单号、商品图片、订单状态)
- **FR-015**: 用户必须能够点击"我的订单"入口或单个订单卡片,跳转到订单列表页或订单详情页
- **FR-016**: 个人中心必须显示常用功能列表区域,包含"收货地址"、"联系客服"、"意见反馈"、"设置"等入口
- **FR-017**: 用户必须能够点击"收货地址"跳转到地址管理页面(为跑腿配送预留)
- **FR-018**: 用户必须能够点击"联系客服"打开客服对话窗口或拨打客服电话
- **FR-019**: 用户必须能够点击"设置"跳转到设置页面,包含"关于我们"、"隐私政策"、"清除缓存"、"退出登录"等选项
- **FR-020**: 设置页面必须提供"退出登录"功能,点击后显示确认弹窗,确认后清除登录状态
- **FR-021**: 个人中心必须为跑腿配送功能预留入口,当前显示"即将上线"标识(灰色或特殊样式)
- **FR-022**: 点击跑腿配送占位入口时,必须显示"跑腿配送功能即将上线,敬请期待"提示
- **FR-023**: 个人中心的所有数据模块(核销券、订单)必须支持下拉刷新
- **FR-024**: 当数据加载失败时,各模块(用户信息、核销券统计、最近核销券列表、订单统计、最近订单列表)必须显示"加载失败,点击重试"提示和重试按钮
- **FR-025**: 当用户头像图片加载失败时,必须显示默认头像占位图
- **FR-026**: 新用户首次进入个人中心,会员等级未初始化时,必须默认显示"普通会员"
- **FR-027**: 个人中心页面必须支持骨架屏加载状态,避免页面闪烁和空白
- **FR-028**: 核销券状态统计必须与实际券列表数据保持一致,刷新页面后同步最新状态
- **FR-029**: 当客服系统不可用时,点击"联系客服"必须显示备选方案(客服电话)

### Key Entities

- **用户(User)**: 应用的注册用户,包含用户ID、头像、昵称、手机号、会员等级、注册时间、当前选择的地区
- **核销券(Voucher)**: 用户购买商品后获得的核销凭证,包含券码、商品信息、购买数量、购买时间、购买地区、有效期、状态(待核销/已核销/已过期)、关联订单号
- **订单(Order)**: 用户的购买记录,包含订单号、商品信息、购买数量、单价、总价、支付方式、支付时间、订单状态(待支付/已支付/已完成/已取消)、配送方式(核销自提/跑腿配送)
- **会员等级(MemberLevel)**: 用户的会员身份标识,包含等级名称(普通会员/VIP1/VIP2等)、等级图标、等级权益描述
- **收货地址(Address)**: 用户保存的收货地址信息(为跑腿配送预留),包含收货人姓名、手机号、省市区、详细地址、是否默认地址
- **系统设置(Settings)**: 用户的个性化设置,包含通知开关、语言设置、隐私设置等

**注**: 个人中心页面不直接处理门店(Store)、商品(Product)等实体,这些实体的交互在核销券详情页和订单详情页中完成。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户从点击TabBar"我的"到个人中心完全加载完成(包括用户信息、核销券、订单)的时间不超过2秒(正常网络环境下)
- **SC-002**: 90%的用户能够在3次点击内完成从个人中心到核销券详情查看二维码的操作
- **SC-003**: 核销券状态统计的准确率达到100%,即统计数字与实际券列表数据完全一致
- **SC-004**: 个人中心的数据刷新响应时间不超过1.5秒(下拉刷新完成到数据更新显示)
- **SC-005**: 用户对个人中心的整体满意度达到85%以上(通过用户反馈或评分调研)
- **SC-006**: 个人中心的加载失败率低于1%(排除用户网络异常)
- **SC-007**: 用户从个人中心进入核销券详情的点击率达到60%以上,表明核销券快速入口设计有效
- **SC-008**: 用户从个人中心进入订单列表的点击率达到30%以上,表明订单入口设计合理
- **SC-009**: 用户头像和用户信息的点击率达到10%以上,表明用户有个人资料编辑需求
- **SC-010**: 个人中心页面的首屏加载时间(骨架屏到首屏内容显示)不超过1秒
- **SC-011**: 因个人中心设计问题导致的客服咨询量不超过总用户量的1%
- **SC-012**: 个人中心页面在正常网络环境下,内存占用不超过50MB,滚动帧率保持在50fps以上(注:后端需保证10000+并发用户的API响应性能)

## Assumptions

1. **用户登录状态**: 假设应用具备完整的用户登录和身份验证机制,个人中心页面可以准确获取当前登录用户的身份信息
2. **数据API可用性**: 假设后端提供完整的用户信息、核销券列表、订单列表查询API,响应时间在正常范围内(200ms以内)
3. **网络环境**: 假设用户在正常网络环境下访问(4G/5G/Wi-Fi),弱网环境通过骨架屏和超时提示优化体验
4. **头像存储**: 假设用户头像存储在CDN或对象存储服务中,URL有效且访问速度快
5. **会员等级体系**: 假设平台已定义完整的会员等级体系和升级规则,用户注册时默认为"普通会员"
6. **核销券和订单关联**: 假设每个核销券都与一个订单关联,订单号是券与订单之间的唯一标识
7. **实时性要求**: 假设个人中心的核销券状态统计不需要实时同步(可接受5-10秒延迟),通过下拉刷新或重新进入页面更新最新数据
8. **地区选择持久化**: 假设用户选择的地区信息已持久化存储(localStorage或后端),进入个人中心时无需重新选择
9. **跑腿配送为占位功能**: 假设当前版本跑腿配送仅预留入口,不实现完整功能,后续版本根据业务需要扩展
10. **客服系统集成**: 假设应用已集成客服系统(在线客服或客服电话),点击"联系客服"可直接打开对话窗口或拨打电话
11. **页面布局适配**: 假设个人中心页面需要适配不同屏幕尺寸的移动设备(主流机型分辨率375px-414px宽度),采用响应式布局
12. **退出登录影响范围**: 假设退出登录只清除当前设备的登录状态,不影响用户在其他设备的登录会话

## Dependencies

- **用户认证服务**: 需要后端提供用户登录验证、登录状态查询、退出登录等接口
- **用户信息API**: 需要后端提供用户基本信息查询接口,返回头像、昵称、会员等级等数据
- **核销券API**: 需要后端提供核销券列表查询接口,支持按状态筛选和分页,以及核销券状态统计接口
- **订单API**: 需要后端提供订单列表查询接口,支持按状态筛选和分页,以及订单数量统计接口
- **图片存储服务**: 需要CDN或对象存储服务存储和提供用户头像、商品图片的URL
- **客服系统**: 需要集成在线客服SDK或提供客服电话配置
- **地址管理功能**: 未来跑腿配送功能需要依赖收货地址管理页面(当前版本预留入口)
- **消息推送服务**: 需要消息推送能力,用于核销券过期提醒、订单状态变更通知等场景
